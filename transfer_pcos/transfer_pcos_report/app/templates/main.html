{% extends "layout.html" %}
{% block head %}
    <meta charset="UTF-8">
    <title>{{ title }}</title>
{% endblock %}

{% block body %}
     <script src="/static/js/jquery.js"></script>
    <script type="text/javascript">
        $("#upFileBtn").click(function(){
            var chip_type =$("#chip_type").val();
            var is_impute =$("#is_impute").val(); 
            var is_update_product =$("#is_update_product").val();
            var email =$("#email").val();
            var formData = new FormData($("#uploadForm"));

            formData.append("file",document.geteElementById("file").files[0]);
            formData.append("genotype",document.geteElementById("genotype").files[0]);
            formData.append("chip_type",chip_type);
            formData.append("is_impute",is_impute);
            formData.append("is_update_product",is_update_product);
            formData.append("email",email);

            $.ajax({
                url:"{{ next_view }}",
                data: formData,
                type:"POST",
                contentType:false,
                processData:false,
                success: function(info){
                    if(info == "success"){
                        alert("上传成功！！！！！");
                    }else{
                        alert("失败了-------");
                    }
                }
                
                })
            })       
    </script>
    <h2>{{ contents }}</h2>
     <a href="{{ url_for('indexView.index') }}">返回主页</a> 
    <hr>
    <form id="uploadForm" method="POST"  enctype ="multipart/form-data">

    <br/>
        上传基因型及样品信息的Excel文件：<br/>
        <input type="file" id="file" name="file" /> 
    <br /><br />

    {% if next_view == '/items200View/items200/' or next_view == '/chipView/chip/' %}
        上传基因型文件,即“genotype.txt”文件：<br/>
        <input type="file" id="genotype" name="genotype" /> <br/>
        <br/>
        如果芯片既不是果壳的也不是拉索的，请先联系管理员
        <br/>
        <input type="radio" id="chip_type" name="chip_type" value="lasuo"> 拉索的芯片数据
        <br/>
        <input type="radio" id="chip_type" name="chip_type" value="guoke"  checked> 果壳的芯片数据
        <br/>
        <input type="checkbox" id="is_impute" name="is_impute" value=True checked> 是否做imputation  (做imputation比较耗时，每10个rs大概20-30分钟左右) 
        <br/>
        <input type="checkbox" id="is_update_product" name="is_update_product" value=True checked> 是否更新产品位点  (从"产品开发系统"中获取最新的rs，如"产品开发系统"没有更新，可不勾选此按钮.如果办公室断网，请取消此勾选项。)
        <br/>
        <br/>
        email:<input type="text" id="email" name="email" required/> <br/>
        (imputation结束后自动发送到邮箱,多个邮箱请用逗号或者分号隔开.如果办公室断网，可以联系管理员由他手动发送impute结果。)
    {% endif %}
    <br/>
    <br/>
    <input type="submit" value="提交生成报告" id="upFileBtn"> 
    </form>
    <br/>
    <hr>
    {% if next_view=='/hyperHealthView/hyperHealth' %}
         本流程在2019.7.29修改了Excel模板，若仍在使用旧的Excel模板，请重新下载下面的Excel模板来填写。
    <br/>
    <br/>
         注：填写Excel模板的时，里面的每一列内容均不可留空，否则无法产生报告；请注意“年龄”及“治疗后收缩压”的填写，具体看下面的示例说明
        由于‘瑞脉康TM脑卒中及冠心病风险检测（高血压）(RH-02)’项目有一个调查问卷，需要把调查问卷里的内容填写到Excel表中，请先下载这份Excel表的模板
         
        <br/>
         <br/>
         <a href="{{ url_for('hyperHealthView.download_template_excel',file_name=file_name) }}">下载模板Excel文件并填写调查问卷</a> 
         
         <br/>
         <br/>
         <h4>填写图示</h4>
        假如有一份调查问卷结果如下：
         <br/>
        <img src="{{url_for('static', filename='img/servey/sample_survey.png')}}" /> 
         <br/>
         则Excel里的info填写结果如下：
         注意： 1、年龄请填写多少岁，比如原来是出生日期，请将出生日期换算为多少岁；2、治疗后收缩压（者没有治疗过就和收缩压保持一致,即“治疗后收缩压”填写的数值与“收缩压”相同,）
        <img src="{{url_for('static', filename='img/servey/survey_excel.png')}}" />
         <br/>
           Excel 里的snp 的填写方式跟其他项目一样 
         <br/>
         (注：填写过程中请不要修改“info” 里面的 列标题，否则程序无法识别)
    {% endif %}
    <br /><br />
    {% if next_view == '/items200View/items200/' or next_view == '/chipView/chip/' %}
    <br/>
        <a href="{{url_for('chipView.chip_help')}}">上传芯片的帮助文档</a>
    {% else %}   
        <a href="{{url_for('PharChildView.PharChild_help')}}">普通项目的帮助文档</a>
    <br/>
    {% endif %}
    <br/>
    <br/>
    <br/>
    <br/>

    <input type="button" name="Submit" value="返回上一页" onclick="javascript:history.back(1)" />


    {% endblock %}

</html>
